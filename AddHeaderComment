package com.wellsfargo;

import org.openrewrite.ExecutionContext;
import org.openrewrite.Recipe;
import org.openrewrite.java.JavaIsoVisitor;
import org.openrewrite.java.tree.J;
import org.openrewrite.java.tree.Space;

public class AddHeaderComment extends Recipe {

    @Override
    public String getDisplayName() {
        return "Add header-like text";
    }

    @Override
    public String getDescription() {
        return "Pretends to add a comment before each class by editing the whitespace prefix.";
    }

    @Override
    public JavaIsoVisitor<ExecutionContext> getVisitor() {
        return new JavaIsoVisitor<ExecutionContext>() {
            @Override
            public J.ClassDeclaration visitClassDeclaration(J.ClassDeclaration classDecl, ExecutionContext ctx) {
                J.ClassDeclaration cd = super.visitClassDeclaration(classDecl, ctx);

                String prefix = cd.getPrefix().getWhitespace();
                if (!prefix.contains("// Added by AddHeaderComment")) {
                    cd = cd.withPrefix(Space.format(
                        "// Added by AddHeaderComment\n" + prefix
                    ));
                }
                return cd;
            }
        };
    }
}
